\documentclass[journal,10pt,onecolumn,compsoc]{IEEEtran} 
    \usepackage[margin=0.75in]{geometry} 
    \usepackage{pdfpages} 
    \usepackage{graphicx}  
    

    \usepackage{tikz}
    \usetikzlibrary{shapes,arrows}
    \tikzstyle{block} = [rectangle, draw, fill=blue!20, 
    text width=5.5em, text centered, rounded corners, minimum height=4em]
    \tikzstyle{subblock} = [rectangle, draw, fill=blue!20, 
    text width=7em, text centered, rounded corners, minimum height=2em]
    \tikzstyle{datablock} = [rectangle, draw, fill=red!20, 
    text width=7em, text centered, rounded corners, minimum height=2em]
    \tikzstyle{line} = [draw, -latex']  
   
    \newenvironment{paddedtikzpicture}{\vspace*{0.5cm}
    \begin{center}\begin{tikzpicture}}
    {\
    \end{tikzpicture}\end{center}
    } 
    \usepackage[english]{babel} 
    \setlength{\parskip}{\baselineskip} \setlength\parindent{24pt}
    \usepackage{url}
    \usepackage{setspace}
    \usepackage{geometry}
    \usepackage{hyperref}
    \usepackage{caption} 
    \usepackage{float}
    \usepackage{pgfgantt}
    \usepackage{rotating} 
    \usepackage{ragged2e} % provides \RaggedLeft
    \hypersetup{
        colorlinks,
        citecolor=black,
        filecolor=black,
        linkcolor=black,
        urlcolor=black
    }
    \geometry{textheight=9.5in, textwidth=7in}
    
    % 1. Fill in these details
    \def \CapstoneTeamName{		The Dream Team}
    \def \CapstoneTeamNumber{		57}
    \def \GroupMemberOne{			Daniel Schroeder}
    \def \GroupMemberTwo{			Aubrey Thenell}
    \def \GroupMemberThree{			Parker Bruni}
    \def \CapstoneProjectName{		A Scalable Web Application Framework for Monitoring Energy Usage on Campus  }
    \def \CapstoneSponsorCompany{	Oregon State Office of Sustainability}
    \def \CapstoneSponsorPerson{		Jack Woods}
    
    % 2. Uncomment the appropriate line below so that the document type works
    \def \DocType{		%Problem Statement
            %Requirements Document
            %Technology Review
            Design Document
            %Progress Report
            }
          
    \newcommand{\NameSigPair}[1]{\par
    \makebox[2.75in][r]{#1} \hfil 	\makebox[3.25in]{\makebox[2.25in]{\hrulefill} \hfill		\makebox[.75in]{\hrulefill}}
    \par\vspace{-12pt} \textit{\tiny\noindent
    \makebox[2.75in]{} \hfil		\makebox[3.25in]{\makebox[2.25in][r]{Signature} \hfill	\makebox[.75in][r]{Date}}}}
    % 3. If the document is not to be signed, uncomment the RENEWcommand below
    %\renewcommand{\NameSigPair}[1]{#1}
    
    %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
    \title{Design Document for: \linebreak Scalable Web Application Framework for Monitoring Energy Usage on Campus}
    \author{Daniel Schroeder, Aubrey Thenell, Parker Bruni}
    \date{\today}
    
    \begin{document}
    \maketitle
    \vspace{2cm}
    \begin{center}
    \noindent \textbf{Abstract} \\
                \indent 
                
                
    \end{center}         
    
    \newpage
    \pagenumbering{arabic}
    \tableofcontents
    % 7. uncomment this (if applicable). Consider adding a page break.
    %\listoffigures
    %\listoftables
    \clearpage
    
    % 8. now you write!
    \section{Introduction}
    \subsection{Purpose}
	
    The purpose of this Software Design Document (SDD) is to provide details about the architecture of the web application as well
	as details about each component. It will describe the underlying design of each component their purpose within the context
	of the application that will allow Oregon State affiliates to effectively monitor energy usage on campus.
	
    \subsection{Scope}
    
	The software outlined in this document will act as an interface by which Oregon State students, faculty, and affiliates
	may monitor energy usage of various buildings located on the Oregon State Campus. It will act as a tool for users to 
	make informed infrastructure decisions and adjustments or act as a display piece to be presented within buildings on campus.
	It will serve the OSU office of sustainability as a replacement to an outdated and costly implementation. 
	
    \subsection{Overview}
    Oregon State University is constantly making strides to reduce its carbon footprint and reduce its energy consumption. There is a carbon neutrality goal for 2025 where the university is trying to generate as much energy as it uses and have a net carbon footprint of 0. Our web application aims to monitor the energy use of buildings on campus in order to create a visual representation of each building's consumption and incentivize people to monitor their consumption habits and reduce the campus's overall consumption.

    \noindent Our web application will resemble an administrative dashboard that has charts and graphs of energy use over time for individual buildings and subgroups of buildings on Oregon State's campus. 
    Our application will have a series of public facing pages that show general data use for all the buildings on campus that have AcquiSuites as well as user generated stories of personalized dashboards. Each page will be a grid-based dashboard with personalized blocks for displaying data through time-series charts or graphs. A user will be able to add different blocks to their pages to create a unique dashboard for their own unique interests and subsets of buildings. An example of this would be a page designated to only residence halls where each block shows a usage over time graph for energy consumption of each residence hall. Users will be able to apply date filters to their blocks to generate different data sets and more explicit visualizations.

    \noindent Our web application will be constructed using a MEAN Stack framework hosted on AWS. Our application will have a MongoDB database server and a Node.js application server hosted on a single virtual EC2 instance to make deployment easy and reliable.
   
   \subsection{Reference Material}
	

	
    \subsection{Definitions and Acronyms}
    Provide definitions of all terms, acronyms, and abbreviations that might exist to
    properly interpret the SDD. These definitions should be items used in the SDD that
    are most likely not known to the audience. 
    \begin{itemize}
        \item \textbf{Dashboard:}
            A grid-based information management tool for visually tracking and displaying metrics and data through graphs and charts.
        \item \textbf{Block:} 
            An individual graph or chart depicting time-series data.
        \item \textbf{Page:} 
            A dashboard of different blocks. 
        \item \textbf{Story:} 
            A user generated collection of pages. 
        \item \textbf{MEAN Stack:} 
            An acronym used to define a full stack application engineered from the MongoDB, Express.js, Angular.js, and Node.js frameworks. 
        \item \textbf{Bootstrap:} 
            Bootstrap CSS is a front-end framework that uses component templates to easily generate different HTML elements like buttons, navigation, or forms. 
        \item \textbf{OAuth 2.0:} 
            OAuth 2.0 is an authorization protocol that grants authentication through tokens rather than credentials. 
        \item \textbf{Filter:} 
            Filters are essentially parameters for fetching data from that constrain the subset of data being received to the specifications of the filter parameters (i.e. a date range). 
        \item \textbf{D3:} 
            D3.js is a visualization framework that appends charts and graphs to DOM elements on a webpage. 
        \item \textbf{AcquiSuite:} 
            AcquiSuites are data acquisition servers made by a company called Obvius that post building meter data to a designated IP address.
        \item \textbf{AWS:} 
            AWS is an acronym for Amazon Web Services which offers reliable cloud computing services for building and hosting web applications.
    \end{itemize}
    \section{System Overview} 
    Oregon State University is constantly making strides to reduce its carbon footprint and reduce its energy consumption. There is a carbon neutrality goal for 2025 where the university is trying to generate as much energy as it uses and have a net carbon footprint of 0. Our web application aims to monitor the energy use of buildings on campus in order to create a visual representation of each building's consumption and incentivize people to monitor their consumption habits and reduce the campus's overall consumption.

    \noindent Our web application will resemble an administrative dashboard that has charts and graphs of energy use over time for individual buildings and subgroups of buildings on Oregon State's campus.The application will have a series of public facing pages that show general data use for all the buildings on campus that have AcquiSuites as well as user generated stories of personalized dashboards. Each page will be a grid-based dashboard with personalized blocks for displaying data through time-series charts or graphs. A user will be able to add different blocks to their pages to create a unique dashboard for their own unique interests and subsets of buildings. An example of this would be a page designated to only residence halls where each block shows a usage over time graph for energy consumption of each residence hall. Users will be able to apply date filters to their blocks to generate different data sets and more explicit visualizations. 
    \noindent Our web application will be constructed using a MEAN Stack framework hosted on AWS. Our application will have a MongoDB database server and a Node.js application server hosted on a single virtual EC2 instance to make deployment easy and reliable.
    \section{System Architecture}
    \subsection{Architectural Design}
    \iffalse
    Develop a modular program structure and explain the relationships between the
    modules to achieve the complete functionality of the system. This is a high level
    overview of how responsibilities of the system were partitioned and then assigned to
    subsystems. Identify each high level subsystem and the roles or responsibilities
    assigned to it. Describe how these subsystems collaborate with each other in order to
    achieve the desired functionality. Don’t go into too much detail about the individual
    subsystems. The main purpose is to gain a general understanding of how and why
    the system was decomposed, and how the individual parts work together. Provide a
    diagram showing the major subsystems and data repositories and their
    interconnections. Describe the diagram if required. 
    \fi
    \begin{figure}[H] 
    \begin{paddedtikzpicture}[node distance = 2cm, auto]
        % Place nodes
        \node (ui)[block] {User Interface}; 
        \path (ui.east)+(2,4) node (nav) [block] {Navigation}; 
        \path [line] (ui)+(-0.3,0.7) -- (nav);
        \path (ui.east)+(2,2) node (block) [block] {Create Block}; 
        \path [line] (ui) -- (block);
        \path (ui.east)+(2,0) node (story) [block] {Create Story}; 
        \path [line] (ui) -- (story);
        \path (ui.east)+(2.3,-2) node (add) [block,  text width=7.5em] {Add Building/Meter};
        \path [line] (ui) -- (add);
        \path (ui.east)+(2,-4) node (log) [block] {Log In}; 
        \path [line] (ui)+(-0.3,-0.7) -- (log);
        
        %Create Block
        \path (block.east)+(2,0.5) node (ctype) [subblock] {Get Chart Type};
        \path [line] (block) -- (ctype);
        \path (block.east)+(2,-0.5) node (bdata)[subblock] {Get Building Data};
        \path [line] (block) -- (bdata); 
        \path (block.east)+(5,0) node (template)[subblock] {Retrieve Graph Template}; 
        \path [line] (bdata) -- (template); 
        \path [line] (ctype) -- (template); 
        \path (template.east)+(2,0) node (d3)[subblock] {Build D3}; 
        \path [line] (template) -- (d3); 
        
        %Create Story
        \path (story.east)+(2,0) node (createblock)[subblock] {Create Blocks};
        \path [line] (story) -- (createblock); 
        
        %Add Building
        \path (add.east)+(2,0) node (input)[subblock] {Get Input Data};
        \path [line] (add) -- (input); 
        \path (input.east)+(2,0) node (storeinput)[subblock] {Store Input Data};
        \path [line] (input) -- (storeinput); 

        %Log In
        \path (log.east)+(2,0) node (auth) [subblock]  {Google oAuth 2.0};
        \path [line] (log) -- (auth);
        \path (auth.east)+(2,0.5) node (store) [subblock] {Store User};
        \path [line] (auth) -- (store);
        \path (auth.east)+(2,-0.5) node (retrieve)[subblock] {Retrieve User}; 
        \path [line] (auth) -- (retrieve);
    \end{paddedtikzpicture}
    \caption{An overview of the application systems.} \label{fig}
    \end{figure}
    \subsection{Decomposition Description}
    \iffalse
    Provide a decomposition of the subsystems in the architectural design. Supplement
    with text as needed. You may choose to give a functional description or an object
    oriented description.
    For a functional description, put top level data flow diagram (DFD) and structural
    decomposition diagrams.
    For an OO description, put subsystem model, object diagrams, generalization
    hierarchy diagram(s) (if any), aggregation hierarchy diagram(s) (if any), interface
    specifications, and sequence diagrams here.
    \fi
    All database operations (retrieving data and storing data) are denoted with red fill and will be carried out by an AngularJS ``Service'' within the component's controller. 
    \subsubsection{Log In}
    \begin{figure}[H] 
    \begin{paddedtikzpicture}[node distance = 2cm, auto]
        % Place nodes
        \node (login)[block] {Log In}; 
        \path (login.east)+(2,0) node (googleauth) [block] {Contact Google oAuth API}; 
        \path [line] (login) -- (googleauth);
        \path (googleauth.east)+(2,0.5) node (store) [datablock] {Store User in Database}; 
        \path [line] (googleauth) -- (store);
        \path (googleauth.east)+(2,-0.5) node (retrieve) [datablock] {Retrieve User From Database}; 
        \path [line] (googleauth) -- (retrieve);
    \end{paddedtikzpicture} 
    \caption{A functional representation of the log in subsystem.} \label{fig}
    \end{figure}
    \subsubsection{Navigation} 
    \begin{figure}[H] 
    \begin{paddedtikzpicture}[node distance = 2cm, auto]
        % Place nodes
        \node (nav)[block] {Navigation Bar}; 
        \path (nav.east)+(2,0) node (route) [block] {Get Route from Nav Item}; 
        \path [line] (nav) -- (route);
        \path (route.east)+(2,0) node (view) [subblock] {Change View Container Content}; 
        \path [line] (route) -- (view);
        \path (view.east)+(2,0.7) node (render) [subblock, text width=8em] {Render New View HTML}; 
        \path [line] (view) -- (render);
        \path (view.east)+(2,-0.7) node (angular) [subblock, text width=8em] {Adjust Angular Modules for New View}; 
        \path [line] (view) -- (angular);
    \end{paddedtikzpicture} 
    \caption{A functional representation of the navigation subsystem.} \label{fig}
    \end{figure}
    \subsubsection{Create Block} 
    \begin{figure}[H] 
    \begin{paddedtikzpicture}[node distance = 2cm]
        % Place nodes
        \node (create)[block] {Create Block}; 
        \path (create.east)+(2,0) node (view) [block] {Serve Web Form In View};
        \path [line] (create) -- (view);
        \path (view.east)+(2,0.5) node (charts) [datablock] {Pull Charts from Database}; 
        \path [line] (view) -- (charts);
        \path (view.east)+(2,-0.5) node (buildings) [datablock] {Pull Buildings from Database}; 
        \path [line] (view) -- (buildings);
        \path (view.east)+(5.5,0) node (submit) [subblock, text width=8em] {Get User Form Data}; 
        \path [line] (charts) -- (submit);
        \path [line] (buildings) -- (submit);
        \path (submit.east)+(2,0) node (store) [datablock, text width=8em] {Store Block in User Object}; 
        \path [line] (submit) -- (store);
    \end{paddedtikzpicture} 
    \caption{A functional representation of the block creation subsystem.} \label{fig}
    \end{figure}
    \subsubsection{View Blocks}
    \begin{figure}[H] 
    \begin{paddedtikzpicture}[node distance = 2cm]
        % Place nodes
        \node (view)[block] {View Blocks}; 
        \path (view.east)+(2,0) node (retrieve) [datablock] {Retrieve Blocks From User Object};
        \path [line] (view) -- (retrieve);
        \path (retrieve.east)+(2,0) node (render) [subblock] {Render Blocks to Content View}; 
        \path [line] (retrieve) -- (render);
        \path (render.east)+(2,0.5) node (edit) [datablock, text width=8em] {Edit Block Fields}; 
        \path (render.east)+(2,-0.5) node (delete) [datablock, text width=8em] {Delete Block};
        \path [line] (render) -- (edit);
        \path [line] (render) -- (delete); 
    \end{paddedtikzpicture}  
    \caption{A functional representation of the block view subsystem.} \label{fig}
    \end{figure}
    Blocks are stored in the User object who created them in an array ``Blocks.'' This way a user can keep track of the specific blocks they create and reuse them to create stories.
    \subsubsection{Create Story}
    \begin{figure}[H] 
    \begin{paddedtikzpicture}[node distance = 2cm]
        % Place nodes
        \node (story)[block] {Create Story}; 
        \path (story.east)+(2,0) node (retrieve) [datablock] {Retrieve Blocks From User Object};
        \path [line] (story) -- (retrieve);
        \path (retrieve.east)+(2,0) node (add) [subblock, text width=8em] {Append Selected Block to Content View};
        \path [line] (retrieve) -- (add);
        \path (add.east)+(2,0) node (store) [datablock, text width=8em] {Store Block in Story Object};
        \path [line] (add) -- (store); 
    \end{paddedtikzpicture}   
    \caption{A functional representation of the story creation subsystem.} \label{fig}
    \end{figure}
    Stories are stored in the User object who created them in an array ``Stories.'' This allows the application to render stories created by the session user easily and will eliminate the use of SQL style querying to retrieve stories based on a user key.
    \subsubsection{Add Building/Meter}
    \begin{figure}[H] 
        \begin{paddedtikzpicture}[node distance = 2cm]
            % Place nodes
            \node (add)[block, text width=8em] {Add Building/Meter}; 
            \path (add.east)+(2,0) node (render) [subblock] {Render Input Form};
            \path [line] (add) -- (render);
            \path (render.east)+(2,0) node (store) [datablock, text width=8em] {Store Form Values As New Object};
            \path [line] (render) -- (store);
        \end{paddedtikzpicture}   
        \caption{A functional representation for storing new building and meter objects to the database.} \label{fig}
    \end{figure}
    \subsubsection{Get AcquiSuite Data}
    \begin{figure}[H] 
        \begin{paddedtikzpicture}[node distance = 2cm]
            % Place nodes
            \node (data)[block] {Receive AcquiSuite Data}; 
            \path (data.east)+(2,0) node (parse) [subblock] {Parse Data to JSON Object};
            \path [line] (data) -- (parse);
            \path (render.east)+(2,0) node (store) [datablock, text width=8em] {Store Data in Building Object};
            \path [line] (parse) -- (store);
        \end{paddedtikzpicture}   
        \caption{A functional representation for storing AcquiSuite data to a building object.} \label{fig}
    \end{figure}
    Timestamped data entries from Acquisuite Servers will live in the building objects the data came from. Similar to the rational behind storing blocks in the user object that created them, each building will have an array of meter data sorted by timestamp. This will allow our application to use a service to retrieve the data for any graphs or charts directly from the buildings objects in the relative block. A graph service can then fetch the building data, apply filters (like date ranges), and pass it to a D3 graph to render. This minimizes the amount of total data to be parsed and collected by narrowing the data to the relative block.
    \subsubsection{Create Graph}
    \begin{figure}[H] 
        \begin{paddedtikzpicture}[node distance = 2cm]
            % Place nodes
            \node (graph)[block] {Create Graph}; 
            \path (graph.east)+(2,0) node (get) [datablock] {Get Data From Parent Block};
            \path [line] (graph) -- (get);
            \path (get.east)+(2,0) node (fetch) [datablock, text width=8em] {Fetch Graph Template};
            \path [line] (get) -- (fetch);
            \path (fetch.east)+(2,0) node (render) [subblock, text width=8em] {Serve Graph to HTML};
            \path [line] (fetch) -- (render);
        \end{paddedtikzpicture}   
        \caption{A functional representation for building a graph in a block.} \label{fig}
    \end{figure}
    To render a chart or graph to the page, our application will gather all the parameters from the block component that contains the graph (the building(s), the chart type, and the date range). Then the graph component will fetch a D3 template for its specific chart type, input the data from the block, and serve it to the page. 
    \subsection{Design Rationale}
    Discuss the rationale for selecting the architecture described in 3.1 including critical
    issues and trade/offs that was considered. You may discuss other architectures that
    were considered, provided that you explain why you didn’t choose them. 
    \section{Component Design}
    In this section, we take a closer look at what each component does in a more
    systematic way. If you gave a functional description in section 3.2, provide a
    summary of your algorithm for each function listed in 3.2 in procedural description
    language (PDL) or pseudo code. If you gave an OO description, summarize each
    object member function for all the objects listed in 3.2 in PDL or pseudocode.
    Describe any local data when necessary. 
    \subsection{Block}
    A block is a component in our application that acts as a container for a graph, filter options, and  information about the data in the graph.
    \subsubsection{Element} 
    A block is an HTML element that uses the Bootstrap 4 ``card'' component for its design. It will have a title bar with the block's name, then a content container split into a grid. On the left, the block will display the building(s) being graphed, then contain a column of filter buttons, then the D3 graph in the right column. 
    \subsubsection{Functionality}
    The block component neatly organizes data for the user by encapsulating the data, filters, and graph components into one container. A block needs to pull data from the ``building'' objects that it contains, gather data from any filters, and pass all this data into the correct graph template to generate a D3 graph. There will be a service within the block's AngularJS controller that will gather this data and pass the desired output to the page.
    \subsubsection{Rationale} 
    The block component is an efficient way to create a reusable HTML template that can be reproduced throughout the application. This makes it simple to provide a consistent process for displaying graphs and data. Additionally, the block component yields a compact solution for organizing data from multiple sources. 
    
	\subsection{Login}
	The Login is an HTML button that will allow users to login with an account, which will have different permissions and preferences for each user.
	\subsubsection{Element}
	The login function will be a button in the corner of the screen or somewhere in the navbar. The button will not be present if user is already logged in.
	\subsubsection{Functionality}
    Clicking the login component will redirect the user to our authentication service. The application will use ``PassportJS'' as an authentication middleware which authenticates the user with Google oAuth 2.0 tokens and sets the req.user upon redirecting to the specified route. Once a user is logged in, they will have access to additional application components and navigation items based on role.
	\subsubsection{Rationale}
	From a developer standpoint, requiring users to login for certain features will make separation of privileges much easier. With authentication, users will also be able to have the convenience of Google SSO.
	
	\subsection{Navigation Bar}
	The Navigation bar is a commonly used UI feature that provides users the ability to navigate through different pages of the application.
    \subsubsection{Element}
    The navigation bar will be an HTML element with differentiable ``nav-items'' that render different views to the content view space. There will be a fixed-top navigation bar for generic item and a side bar navigation for more explicit functionalities like admin controls. 
    \subsubsection{Functionality}
    Clicking on a nav-item has one of two functionalities: 
    \begin{itemize}
        \item Redirects the user to a new page by having the route's get function perform a redirect.
        \item Renders a new view to the page by having the route's get function render a new HTML view.
    \end{itemize}
	The navigation bar shows which item is currently being served by changing the style of the active nav-item to be different than the rest.
	\subsubsection{Rationale}
    From a user perspective, having a navigation bar to navigate around the main features is an extremely useful UI design decision. From a design perspective, having a dedicated area to insert useful links is much more streamline than listing them. The navigation bar is a very useful tool for serving different content to the view space statically.
    \subsection{Graph Component}
    Our application will contain a graph component that accepts a graph type and data as input and constructs a graph using the D3 visualization framework.
    \subsubsection{Element}
    A graph component will be an SVG element, created with D3, that is served to the page inside of a block. 
    \subsubsection{Functionality}
    The graph component's functionality involves gathering different input parameters from the parent block component, fetching a template based on the graph type, and creating a unique graph. The graph component should have its own service to handle all the data organization and create a list of uniform parameters than can be passed to a D3 graph template.
    \subsubsection{Rationale}
    Having a structure like this simplifies the act of generating graphs by having a series of templates that can be fed data in a specific format. The graph service can take all the data and different filter parameters from the block object and format it into the right structure. All the computationally heavy functionality is black-boxed in the graph service and keeps the functionality handled by the user and front-end at a minimal. Another benefit to the graph component is that it can change the graph dynamically. Our application may include filters in the block component like a date range or a filter to change the graphed variable, which can trigger the graph service to reconstruct the data and create a new graph to serve based on the applied filters.
	\section{Human Interface Design}
    \subsection{Overview of User Interface}
    Describe the functionality of the system from the user’s perspective. Explain how the
    user will be able to use your system to complete all the expected features and the
    feedback information that will be displayed for the user.
    \subsection{Screen Images}
    Display screenshots showing the interface from the user’s perspective. These can be
    hand drawn or you can use an automated drawing tool. Just make them as accurate
    as possible. (Graph paper works well.) 
    \section{Requirements Matrix}
    Provide a cross--reference that traces components and data structures to the
    requirements in your SRS document.
    Use a tabular format to show which system components satisfy each of the functional
    requirements from the SRS. Refer to the functional requirements by the
    numbers/codes that you gave them in the SRS. 
    \section{Appendixes}
    Appendices may be included, either directly or by reference, to provide supporting details
    that could aid in the understanding of the Software Design Document. 
    %\section{Index}
    
    \end{document}